---
phase: 01-infrastructure-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All PRD-defined database tables exist in schema"
    - "leads table has all required fields per PRD"
    - "lead_communications table captures call/SMS/email data"
    - "agent_scripts table supports script targeting"
    - "scheduled_actions table enables automated follow-ups"
    - "conversion_events table tracks $40â†’$100 journey"
  artifacts:
    - path: "lib/db/schema.ts"
      provides: "Complete database schema"
      contains: "leads"
    - path: ".planning/phases/01-infrastructure-verification/01-01-SUMMARY.md"
      provides: "Schema verification results"
---

<objective>
Verify database schema completeness against PRD-LIVEKIT-CALL-CENTER.md requirements.

Purpose: Ensure all required tables and fields exist before building UI/features that depend on them.
Output: Verification report documenting schema status and any gaps.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

PRD Reference:
@docs/PRD-LIVEKIT-CALL-CENTER.md

Schema File:
@lib/db/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify leads table schema</name>
  <files>lib/db/schema.ts</files>
  <action>
  Read lib/db/schema.ts and verify the `leads` table contains all PRD-required fields:
  - id (uuid, primary key)
  - source, sourceDetails (lead source tracking)
  - firstName, lastName, email, phone (contact info)
  - businessType, businessName, estimatedParticipants (business context)
  - interestLevel, interestScore, lastActivityAt, activityHistory (scoring)
  - city, state, zipCode, timezone (geographic)
  - initialValue, convertedValue (lead value)
  - status, statusReason (workflow)
  - assignedAgentId (assignment)
  - convertedAt, convertedPolicyId (conversion)
  - createdAt, updatedAt (timestamps)

  Document which fields exist, which are missing, and any naming differences.
  </action>
  <verify>grep -c "leads" lib/db/schema.ts returns > 0</verify>
  <done>leads table documented with field-by-field comparison to PRD</done>
</task>

<task type="auto">
  <name>Task 2: Verify lead_communications table schema</name>
  <files>lib/db/schema.ts</files>
  <action>
  Verify `lead_communications` or `leadCommunications` table contains:
  - id (uuid)
  - leadId (foreign key)
  - channel (call/sms/email)
  - direction (inbound/outbound)
  - callDuration, callRecordingUrl, callTranscript, callSummary (call-specific)
  - smsContent, smsStatus (SMS-specific)
  - disposition, nextFollowUpAt (outcome)
  - agentId, agentScriptUsed, agentConfidenceScore (AI tracking)
  - sentimentScore, outcome (analysis)
  - livekitRoomId, livekitSessionId (LiveKit)
  - createdAt

  Document gaps if any.
  </action>
  <verify>grep -c "communication" lib/db/schema.ts returns > 0</verify>
  <done>lead_communications table documented</done>
</task>

<task type="auto">
  <name>Task 3: Verify agent_scripts table schema</name>
  <files>lib/db/schema.ts</files>
  <action>
  Verify `agent_scripts` or `agentScripts` table contains:
  - id (uuid)
  - name, description
  - businessType, interestLevel, geographicRegion (targeting)
  - systemPrompt, openingScript, keyPoints, objectionHandlers, closingScript (content)
  - maxCallDuration, voiceId (configuration)
  - isActive, priority
  - createdAt, updatedAt

  Document gaps if any.
  </action>
  <verify>grep -c "script" lib/db/schema.ts returns > 0</verify>
  <done>agent_scripts table documented</done>
</task>

<task type="auto">
  <name>Task 4: Verify scheduled_actions and conversion_events tables</name>
  <files>lib/db/schema.ts</files>
  <action>
  Verify `scheduled_actions` or `scheduledActions` table contains:
  - id, leadId, actionType, scheduledFor
  - reason, scriptId, customMessage
  - status, attempts, maxAttempts
  - processedAt, error, createdAt

  Verify `conversion_events` or `conversionEvents` table contains:
  - id, leadId
  - eventType, eventValue
  - metadata, createdAt

  Document gaps if any.
  </action>
  <verify>grep -c "scheduled\|conversion" lib/db/schema.ts returns > 0</verify>
  <done>scheduled_actions and conversion_events tables documented</done>
</task>

<task type="auto">
  <name>Task 5: Create schema verification summary</name>
  <files>.planning/phases/01-infrastructure-verification/01-01-SUMMARY.md</files>
  <action>
  Create comprehensive summary documenting:
  - Tables verified: leads, lead_communications, agent_scripts, scheduled_actions, conversion_events
  - Status for each: EXISTS (all fields) | PARTIAL (missing fields listed) | MISSING
  - Any migration needed
  - Blockers for subsequent phases
  </action>
  <verify>cat .planning/phases/01-infrastructure-verification/01-01-SUMMARY.md exists</verify>
  <done>Summary created with verification results</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All 5 PRD tables verified against schema
- [ ] Summary created with clear status for each table
- [ ] Any missing fields documented
</verification>

<success_criteria>
- All tasks completed
- Schema status documented for all PRD tables
- Gaps (if any) clearly identified for follow-up
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-verification/01-01-SUMMARY.md`
</output>

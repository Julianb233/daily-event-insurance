# Plan 03-02: Call Initiation with LiveKit

**Phase:** 3 - Lead Management Enhancement
**Status:** PLANNED
**Estimated Complexity:** Medium

## Objective

Connect the lead detail page to LiveKit for initiating outbound calls to leads using the AI voice agent.

## Prerequisites

- Plan 03-01 complete (lead detail page)
- LiveKit infrastructure verified (Phase 1)
- Existing call center page patterns

## Implementation

### Components to Create

1. **CallModal Component** (`components/admin/CallModal.tsx`)
   - Script selection dropdown
   - Call status indicator
   - Real-time audio visualizer
   - End call button
   - Call duration timer

2. **Update Call API** (`app/api/admin/leads/[id]/call/route.ts`)
   - Generate LiveKit room token
   - Store room/session IDs in communication record
   - Return connection details

### LiveKit Integration

```typescript
// Flow:
1. User clicks "Call Now" on lead detail
2. POST to /api/admin/leads/[id]/call with scriptId
3. API creates LiveKit room, generates tokens
4. Modal opens with LiveKitRoom component
5. AI agent joins room automatically
6. Agent dials lead's phone (SIP trunk)
7. Communication record updated with outcome
```

### API Updates

- Add LiveKit room creation
- Generate participant tokens
- Store LiveKit metadata in communication

## Verification

- [ ] Call modal opens from lead detail
- [ ] LiveKit room created successfully
- [ ] Audio connection established
- [ ] Call duration tracked
- [ ] Communication record created

## Dependencies

- LiveKit SDK (`@livekit/components-react`)
- Voice API route (`/api/voice/realtime`)
- Agent scripts API

---
*Created: 2025-01-15 | Phase 3: Lead Management Enhancement*
